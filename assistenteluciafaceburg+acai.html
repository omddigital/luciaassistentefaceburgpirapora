<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistente L√∫cia - Face Burg + A√ßa√≠</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        .chat-container {
            max-height: none;
            height: auto;
        }
        .message-bubble {
            max-width: 80%;
            word-wrap: break-word;
        }
        .typing-indicator {
            display: none;
        }
        .typing-indicator.show {
            display: flex;
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        .whatsapp-green {
            background-color: #25D366;
        }
        .whatsapp-gray {
            background-color: #E5E5EA;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
        }
    </style>
</head>
<body class="bg-green-50">
    <div class="min-h-screen p-4">
        <!-- Header -->
        <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg overflow-hidden">
            <div class="whatsapp-green text-white p-4">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-white rounded-full flex items-center justify-center mr-3">
                        <i class="fas fa-hamburger text-green-600 text-xl"></i>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold">Assistente L√∫cia</h1>
                        <p class="text-sm opacity-90">Face Burg + A√ßa√≠ ‚Ä¢ Online</p>
                    </div>
                </div>
            </div>

            <!-- Sistema de Demonstra√ß√£o -->
            <div class="p-6 bg-blue-50 border-b">
                <h2 class="text-lg font-bold text-blue-800 mb-2">
                    <i class="fas fa-info-circle mr-2"></i>Sistema de Demonstra√ß√£o
                </h2>
                <p class="text-blue-700 mb-4">
                    Este √© o assistente L√∫cia configurado exatamente conforme suas instru√ß√µes. Teste os diferentes fluxos digitando mensagens como "oi", "pedido", ou consultando fora do hor√°rio.
                </p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                    <div class="bg-white p-3 rounded">
                        <strong class="text-green-600">‚è∞ Hor√°rio:</strong><br>
                        18h √†s 01h (Bras√≠lia)
                    </div>
                    <div class="bg-white p-3 rounded">
                        <strong class="text-blue-600">üçî Especialidade:</strong><br>
                        Hamb√∫rgueres + A√ßa√≠
                    </div>
                    <div class="bg-white p-3 rounded">
                        <strong class="text-purple-600">üöö Entrega:</strong><br>
                        R$ 5,00 - R$ 8,00
                    </div>
                </div>
            </div>

            <!-- Chat Interface -->
            <div class="chat-container bg-gray-100 p-4" style="min-height: 600px;">
                <div id="chatMessages" class="space-y-4">
                    <div class="text-center text-gray-500 text-sm mb-4">
                        <i class="fas fa-clock mr-1"></i>
                        <span id="currentTime"></span>
                    </div>
                </div>

                <!-- Typing Indicator -->
                <div id="typingIndicator" class="typing-indicator items-center space-x-2 p-2">
                    <div class="w-8 h-8 bg-gray-300 rounded-full flex items-center justify-center">
                        <i class="fas fa-robot text-xs"></i>
                    </div>
                    <div class="bg-white p-2 rounded-lg">
                        <div class="flex space-x-1">
                            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                            <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="bg-white p-4 border-t">
                <div class="flex space-x-2">
                    <input 
                        type="text" 
                        id="messageInput" 
                        placeholder="Digite sua mensagem..." 
                        class="flex-1 p-3 border border-gray-300 rounded-full focus:outline-none focus:border-green-500"
                        onkeypress="if(event.key==='Enter') sendMessage()"
                    >
                    <button 
                        onclick="sendMessage()" 
                        class="whatsapp-green text-white px-6 py-3 rounded-full hover:bg-green-600 transition-colors"
                    >
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="bg-gray-50 p-4 border-t">
                <h3 class="text-sm font-semibold text-gray-600 mb-2">Teste r√°pido:</h3>
                <div class="flex flex-wrap gap-2">
                    <button onclick="quickMessage('oi')" class="bg-white px-3 py-1 rounded-full text-sm border hover:bg-gray-100">Oi</button>
                    <button onclick="quickMessage('pedido')" class="bg-white px-3 py-1 rounded-full text-sm border hover:bg-gray-100">Pedido</button>
                    <button onclick="quickMessage('card√°pio')" class="bg-white px-3 py-1 rounded-full text-sm border hover:bg-gray-100">Card√°pio</button>
                    <button onclick="quickMessage('pizza')" class="bg-white px-3 py-1 rounded-full text-sm border hover:bg-gray-100">Pizza</button>
                    <button onclick="quickMessage('obrigado')" class="bg-white px-3 py-1 rounded-full text-sm border hover:bg-gray-100">Obrigado</button>
                </div>
            </div>
        </div>

        <!-- Fluxo Documentation -->
        <div class="max-w-4xl mx-auto mt-6 bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">
                <i class="fas fa-flow-chart mr-2 text-blue-600"></i>
                Fluxo Completo - Assistente L√∫cia
            </h2>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Bloco 1 -->
                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                    <h3 class="font-bold text-blue-800 mb-2">üîπ Gatilho Inicial</h3>
                    <p class="text-sm text-blue-700 mb-2"><strong>Palavras-chave:</strong></p>
                    <div class="text-xs bg-white p-2 rounded">
                        oi, ol√°, boa noite, bom dia, boa tarde, tudo bem, hei, pedido, fazendo pedido, entregando, fazendo entrega, entrega, t√° entregando, pedido aberto, aceitam pedido, aberto
                    </div>
                    <p class="text-xs text-blue-600 mt-2">‚û°Ô∏è Vai para: Verifica√ß√£o de Hor√°rio</p>
                </div>

                <!-- Bloco 2 -->
                <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                    <h3 class="font-bold text-yellow-800 mb-2">‚è∞ Verifica√ß√£o de Hor√°rio</h3>
                    <div class="text-sm text-yellow-700">
                        <p><strong>01:01 √†s 17:59:</strong> Fora do Hor√°rio</p>
                        <p><strong>18:00 √†s 01:00:</strong> In√≠cio do Atendimento</p>
                    </div>
                </div>

                <!-- Bloco 3 -->
                <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                    <h3 class="font-bold text-red-800 mb-2">üîí Fora do Hor√°rio</h3>
                    <p class="text-xs text-red-700">
                        Informa que entregas foram finalizadas e hor√°rio de funcionamento (18h √†s 1h). Encerra atendimento.
                    </p>
                </div>

                <!-- Bloco 4 -->
                <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                    <h3 class="font-bold text-green-800 mb-2">üìã In√≠cio do Atendimento</h3>
                    <p class="text-xs text-green-700">
                        Boas-vindas, apresenta card√°pio (link), informa hor√°rio. Redireciona para Sugest√£o de Combos.
                    </p>
                </div>

                <!-- Bloco 5 -->
                <div class="bg-purple-50 p-4 rounded-lg border border-purple-200">
                    <h3 class="font-bold text-purple-800 mb-2">üïê Aviso Retirada</h3>
                    <p class="text-xs text-purple-700">
                        Entre 01:00-01:10: Informa que ap√≥s 1h atende apenas para retirada no local.
                    </p>
                </div>

                <!-- Bloco 6 -->
                <div class="bg-orange-50 p-4 rounded-lg border border-orange-200">
                    <h3 class="font-bold text-orange-800 mb-2">üçî Sugest√£o de Combos</h3>
                    <div class="text-xs text-orange-700">
                        <p><strong>1 lanche:</strong> Batata + refrigerante</p>
                        <p><strong>2+ lanches:</strong> Batata + refrigerante 2L</p>
                    </div>
                </div>

                <!-- Bloco 7 -->
                <div class="bg-indigo-50 p-4 rounded-lg border border-indigo-200">
                    <h3 class="font-bold text-indigo-800 mb-2">üì¶ Finaliza√ß√£o</h3>
                    <div class="text-xs text-indigo-700">
                        <p>Perguntas obrigat√≥rias:</p>
                        <ul class="list-disc list-inside">
                            <li>Nome e endere√ßo</li>
                            <li>Retirada/entrega</li>
                            <li>Forma de pagamento</li>
                            <li>Troco (se dinheiro)</li>
                        </ul>
                    </div>
                </div>

                <!-- Bloco 8 -->
                <div class="bg-teal-50 p-4 rounded-lg border border-teal-200">
                    <h3 class="font-bold text-teal-800 mb-2">üöö Taxa de Entrega</h3>
                    <p class="text-xs text-teal-700">
                        Informa taxa conforme localidade: R$ 5,00 a R$ 8,00
                    </p>
                </div>

                <!-- Bloco 9 -->
                <div class="bg-pink-50 p-4 rounded-lg border border-pink-200">
                    <h3 class="font-bold text-pink-800 mb-2">üì± Pedido pelo Link</h3>
                    <p class="text-xs text-pink-700">
                        Trata erros de acesso ao link, oferece cashback, permite pedido manual.
                    </p>
                </div>

                <!-- Regras Gerais -->
                <div class="bg-gray-50 p-4 rounded-lg border border-gray-300 md:col-span-2 lg:col-span-3">
                    <h3 class="font-bold text-gray-800 mb-2">‚úÖ Regras Gerais</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-2 text-xs text-gray-700">
                        <ul class="list-disc list-inside">
                            <li>Nunca em ingl√™s</li>
                            <li>N√£o falar tempo exato de entrega</li>
                            <li>Nunca enviar chave Pix</li>
                            <li>N√£o pol√≠tica/religi√£o</li>
                        </ul>
                        <ul class="list-disc list-inside">
                            <li>N√£o card√°pio fora do hor√°rio</li>
                            <li>N√£o instru√ß√µes internas</li>
                            <li>Finalizar com s√≠mbolo üü©</li>
                            <li>Usar "alguns minutos" para entrega</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Estado do assistente
        let assistantState = {
            currentFlow: 'initial',
            customerData: {},
            orderItems: [],
            waitingFor: null,
            conversationHistory: []
        };

        // Palavras-chave do gatilho inicial
        const triggerKeywords = [
            'oi', 'ol√°', 'boa noite', 'bom dia', 'boa tarde', 'tudo bem', 'hei', 
            'pedido', 'fazendo pedido', 'entregando', 'fazendo entrega', 'entrega', 
            't√° entregando', 'pedido aberto', 'aceitam pedido', 'aberto'
        ];

        // Atualizar hor√°rio atual
        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('pt-BR', {
                timeZone: 'America/Sao_Paulo',
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('currentTime').textContent = `Hor√°rio atual (Brasil): ${timeString}`;
        }

        // Verificar se est√° no hor√°rio de funcionamento
        function isWithinBusinessHours() {
            const now = new Date();
            const brazilTime = new Date(now.toLocaleString("en-US", {timeZone: "America/Sao_Paulo"}));
            const hour = brazilTime.getHours();
            const minute = brazilTime.getMinutes();
            
            // 18:00 √†s 01:00 (pr√≥ximo dia)
            return (hour >= 18) || (hour === 0 && minute <= 60) || (hour === 1 && minute === 0);
        }

        // Verificar se √© hor√°rio de retirada (01:00-01:10)
        function isPickupOnlyTime() {
            const now = new Date();
            const brazilTime = new Date(now.toLocaleString("en-US", {timeZone: "America/Sao_Paulo"}));
            const hour = brazilTime.getHours();
            const minute = brazilTime.getMinutes();
            
            return hour === 1 && minute >= 0 && minute <= 10;
        }

        // Adicionar mensagem ao chat
        function addMessage(text, isUser = false, delay = 0) {
            setTimeout(() => {
                const chatMessages = document.getElementById('chatMessages');
                const messageDiv = document.createElement('div');
                messageDiv.className = `flex ${isUser ? 'justify-end' : 'justify-start'} mb-4`;
                
                const bubble = document.createElement('div');
                bubble.className = `message-bubble p-3 rounded-lg ${
                    isUser 
                        ? 'whatsapp-green text-white rounded-br-none' 
                        : 'whatsapp-gray text-gray-800 rounded-bl-none'
                }`;
                
                // Preservar quebras de linha e formata√ß√£o
                bubble.innerHTML = text.replace(/\n/g, '<br>');
                
                if (!isUser) {
                    const avatar = document.createElement('div');
                    avatar.className = 'w-8 h-8 bg-green-600 rounded-full flex items-center justify-center mr-2 flex-shrink-0';
                    avatar.innerHTML = '<i class="fas fa-robot text-white text-xs"></i>';
                    messageDiv.appendChild(avatar);
                }
                
                messageDiv.appendChild(bubble);
                chatMessages.appendChild(messageDiv);
                
                // Scroll to bottom
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Hide typing indicator
                document.getElementById('typingIndicator').classList.remove('show');
            }, delay);
        }

        // Mostrar indicador de digita√ß√£o
        function showTyping() {
            document.getElementById('typingIndicator').classList.add('show');
        }

        // Processar mensagem do usu√°rio
        function processMessage(message) {
            const normalizedMessage = message.toLowerCase().trim();
            
            // Salvar no hist√≥rico
            assistantState.conversationHistory.push({
                user: message,
                timestamp: new Date()
            });

            // Verificar se cont√©m palavras-chave do gatilho inicial
            const containsTrigger = triggerKeywords.some(keyword => 
                normalizedMessage.includes(keyword.toLowerCase())
            );

            if (containsTrigger || assistantState.currentFlow === 'initial') {
                return processInitialTrigger();
            }

            // Processar pedido de pizza
            if (normalizedMessage.includes('pizza')) {
                return processPizzaRequest();
            }

            // Processar avalia√ß√£o
            if (['obrigado', 'valeu', 'ok'].includes(normalizedMessage)) {
                return processEvaluation();
            }

            // Processar baseado no estado atual
            switch (assistantState.currentFlow) {
                case 'ordering':
                    return processOrdering(normalizedMessage);
                case 'finalizing':
                    return processFinalization(normalizedMessage);
                default:
                    return processGeneral(normalizedMessage);
            }
        }

        // Processar gatilho inicial
        function processInitialTrigger() {
            showTyping();
            
            if (!isWithinBusinessHours()) {
                // Fora do hor√°rio
                setTimeout(() => {
                    addMessage(`Ol√°! Gostar√≠amos de informar que as entregas foram finalizadas para o dia de hoje.

Realizamos entregas apenas entre as 18h e 1h da manh√£ (hor√°rio de Bras√≠lia).

Agradecemos pela sua compreens√£o e estamos sempre √† disposi√ß√£o para esclarecer qualquer d√∫vida üòä.`);
                }, 1500);
                
                assistantState.currentFlow = 'closed';
                return;
            }

            // Dentro do hor√°rio - in√≠cio do atendimento
            setTimeout(() => {
                let message = `Ol√°! Boa noite! Seja bem-vindo(a) √† Face Burg + A√ßa√≠! J√° sabe o que vai pedir ou gostaria de ver nosso card√°pio?

CARD√ÅPIO FACE BURG: https://bit.ly/CARD√ÅPIOFACEBURGACAI

üü© Nossas entregas acontecem das 18h √† 1h da manh√£. Pedidos realizados ap√≥s esse hor√°rio n√£o poder√£o ser entregues.`;

                // Adicionar aviso de retirada se necess√°rio
                if (isPickupOnlyTime()) {
                    message += `\n\nA partir da 1h da manh√£, continuamos atendendo apenas para retirada no local. Se quiser passar aqui e buscar seu pedido, ficaremos felizes em preparar tudo para voc√™! üòä`;
                }

                addMessage(message);
                assistantState.currentFlow = 'menu_shown';
            }, 1500);
        }

        // Processar pedido de pizza
        function processPizzaRequest() {
            showTyping();
            
            setTimeout(() => {
                addMessage(`Ol√°! No momento, trabalhamos apenas com hamb√∫rgueres. Para pedir pizza, √© s√≥ falar com a pizzaria Face Burg pelo WhatsApp: 38 99950-4303. Qualquer d√∫vida, estou √† disposi√ß√£o! üòä`);
            }, 1000);
        }

        // Processar avalia√ß√£o
        function processEvaluation() {
            showTyping();
            
            setTimeout(() => {
                addMessage(`Ficamos muito felizes em te atender! Se quiser, deixe uma avalia√ß√£o sobre o atendimento üß° Isso nos ajuda muito!`);
            }, 1000);
        }

        // Processar pedidos
        function processOrdering(message) {
            showTyping();
            
            // Simula√ß√£o de sugest√£o de combos
            setTimeout(() => {
                if (message.includes('lanche') || message.includes('hamb√∫rguer')) {
                    if (message.includes('2') || message.includes('dois')) {
                        addMessage(`Que tal acrescentar batata frita e um refrigerante de 2 litros para acompanhar?`);
                    } else {
                        addMessage(`Que tal acrescentar uma batata frita ao seu lanche? E um refrigerante para acompanhar?`);
                    }
                    assistantState.currentFlow = 'suggesting_combo';
                } else {
                    addMessage(`Posso anotar seu pedido. O que gostaria de pedir?`);
                }
            }, 1000);
        }

        // Processar finaliza√ß√£o
        function processFinalization(message) {
            showTyping();
            
            setTimeout(() => {
                if (!assistantState.customerData.name) {
                    addMessage(`Posso finalizar seu pedido? Preciso do seu nome completo e endere√ßo, por favor.`);
                    assistantState.waitingFor = 'customer_info';
                } else if (!assistantState.customerData.paymentMethod) {
                    addMessage(`Forma de pagamento: Pix, cart√£o ou dinheiro?`);
                    assistantState.waitingFor = 'payment';
                } else {
                    // Finalizar pedido
                    const orderSummary = `Pedido Lanchonete Face Burg

Nome: ${assistantState.customerData.name || '[Nome do Cliente]'}

Endere√ßo: ${assistantState.customerData.address || '[Endere√ßo do Cliente]'}

Itens:
‚û°Ô∏è X-Burguer x1 ‚Äì R$ 18,00
‚û°Ô∏è Batata frita x1 ‚Äì R$ 10,00
‚û°Ô∏è Refrigerante 2L x1 ‚Äì R$ 15,00

Soma total: R$ 43,00

Forma de pagamento: ${assistantState.customerData.paymentMethod || '[Pix / Cart√£o / Dinheiro]'}

Retirada/Entrega: ${assistantState.customerData.delivery || '[Cliente retira / Entregar no endere√ßo]'}

Troco para: ${assistantState.customerData.change || 'N√£o necess√°rio'}

‚úÖ Fechado üü©`;

                    addMessage(orderSummary);
                    assistantState.currentFlow = 'completed';
                }
            }, 1000);
        }

        // Processar mensagens gerais
        function processGeneral(message) {
            showTyping();
            
            setTimeout(() => {
                if (message.includes('taxa') || message.includes('entrega')) {
                    addMessage(`Ol√°! Ser√° cobrada uma taxa de entrega conforme sua localidade, variando entre R$ 5,00 e R$ 8,00. Qualquer d√∫vida, estou √† disposi√ß√£o üòä.`);
                } else if (message.includes('pedido') && message.includes('link')) {
                    addMessage(`Se preferir, voc√™ pode fazer seu pedido pelo nosso link! √â mais r√°pido e voc√™ ainda ganha cashback. Mas, se n√£o conseguir, posso anotar seu pedido por aqui üòä.`);
                } else if (message.includes('acompanhar') || message.includes('status')) {
                    addMessage(`Seu pedido est√° em produ√ß√£o neste momento! Qualquer novidade, aviso por aqui. Fique tranquilo, estamos cuidando de tudo para voc√™. üòä`);
                } else {
                    addMessage(`Ol√°! Como posso ajudar voc√™ hoje? Gostaria de ver nosso card√°pio ou fazer um pedido?`);
                }
            }, 1000);
        }

        // Enviar mensagem
        function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (message === '') return;
            
            // Adicionar mensagem do usu√°rio
            addMessage(message, true);
            
            // Limpar input
            input.value = '';
            
            // Processar resposta da IA
            setTimeout(() => {
                processMessage(message);
            }, 500);
        }

        // Mensagem r√°pida
        function quickMessage(text) {
            document.getElementById('messageInput').value = text;
            sendMessage();
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            
            // Mensagem inicial
            setTimeout(() => {
                addMessage(`Ol√°! Eu sou a L√∫cia, assistente virtual da Face Burg + A√ßa√≠! üëã

Digite qualquer mensagem para come√ßar nosso atendimento. Experimente palavras como "oi", "pedido", "card√°pio"...

‚è∞ Lembre-se: atendemos das 18h √† 1h da manh√£!`);
            }, 1000);
        });

        // Enter para enviar
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>
